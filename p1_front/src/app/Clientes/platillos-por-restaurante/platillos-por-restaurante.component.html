<app-header />



<div class="card flex justify-center mb-2">
  <p-fieldset legend="Gestion de Platillos">
    <p class="m-0">
      Para crear una nuevo platillo haga click en el boton
    </p>
    <p-button label="Nuevo Platillo" class="w-full" styleClass="w-full" (onClick)="this.verDialogoNuevaHabitacion()" />
  </p-fieldset>
</div>

<!-- para visualizar la tabla de compras-->
<div class="card flex justify-center mb-2">
  <p-fieldset legend="Gestion de compras">
    <div class="card">
      <p-table [value]="this.carrito.carrito()" stripedRows [tableStyle]="{'min-width': '50rem'}"
        [paginator]="true"
    [rows]="5"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rowsPerPageOptions]="[5, 10, 20]"
    >
        <ng-template #header>
          <tr>
            <th>No.</th>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Precio Parcial</th>
          </tr>
        </ng-template>
        <ng-template #body let-product let-rowIndex="rowIndex">
          <tr>
            <td>{{rowIndex+1}}</td>
            <td>{{product.nombre}}</td>
            <td>{{product.precio}}</td>
            <td>

              <div class="card flex justify-center">
                <p-inputnumber [(ngModel)]="product.cantidad" [showButtons]="true" buttonLayout="horizontal"
                [min]="1"
                  spinnerMode="vertical" inputId="vertical" [inputStyle]="{ width: '3rem' }">
                  <ng-template #incrementbuttonicon>
                    <span class="pi pi-plus"></span>
                  </ng-template>
                  <ng-template #decrementbuttonicon>
                    <span class="pi pi-minus"></span>
                  </ng-template>
                </p-inputnumber>
              </div>
            </td>

            <td>{{product.precio*product.cantidad}}</td>

               <td>
                <p-button icon="pi pi-times"  severity="danger" rounded (onClick)="this.carrito.eliminarPlatilloCarrito(product.id)"/>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <p-button label="Comprar" class="w-full" styleClass="w-full" (onClick)="this.comprar()" 
    [disabled]="this.carrito.carrito().length<=0"/>

  </p-fieldset>
</div>

<!-- Panel LISTADO -->
<div class="h-full w-full mb-2">
  <div style="
            display: grid;
            grid-template-columns: repeat(3, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
          ">
    @for (item of this.paginatedItems; track $index) {
    <p-card [style]="{
                width: '100%',
                overflow: 'hidden',
                borderRadius: '1rem',
                boxShadow: '0 4px 12px rgba(0,0,0,0.08)'
              }">

      <ng-template #title>
        <span style="font-weight: 600;"> {{ item.nombre }}</span>
      </ng-template>
      <ng-template #subtitle>
        <span style="color: #6b7280;">{{ item.precio | currency:'GTQ':'symbol':'1.2-2' }}</span>
      </ng-template>
      <p-tag severity="info" value="{{item.tipo}}" />

      <div class="card flex justify-center">
        <p-rating [(ngModel)]="item.promedio_valoracion" [readonly]="true"></p-rating>

      </div>

      <ng-template #footer>
        <div class="flex gap-4 mt-1">
          <p-button label="Ver comentarios" class="w-full" styleClass="w-full" (click)="showDialog(item.id)" />
          <p-button label="Comprar" class="w-full" styleClass="w-full"
            (onClick)="this.AgregarPlatillo(item)" />
        </div>
      </ng-template>
    </p-card>
    }
  </div>

  <!-- paginator -->
  <div style="margin-top: 1rem; display: flex; justify-content: center;">
    <p-paginator [first]="first" [rows]="rows" [totalRecords]="items.length" [rowsPerPageOptions]="[3, 6, 10]"
      (onPageChange)="cambiarPagina($event)" />
  </div>
</div>


<!-- comentarios en una habitacion-->
<div class="card flex justify-center">
  <p-dialog header="Comentarios" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
    <div class="card flex justify-content-center">
      <p-accordion value="0">
        @for (item of this.listadoComentarios; track $index) {
        <p-accordion-panel value="$index">
          <p-accordion-header>
            <ng-template #toggleicon let-active="active">
              @if (active) {
              <i class="pi pi-minus"></i>
              } @else {
              <i class="pi pi-plus"></i>
              }
            </ng-template>
            <span class="flex items-center gap-2 w-full">
              <span class="font-bold whitespace-nowrap">Comentario No.{{$index}}</span>
              <p-badge value="{{item.puntuacion}}" class="ml-auto mr-2" />
            </span>
          </p-accordion-header>
          <p-accordion-content>
            <p class="m-0">
              {{item.comentario}}
            </p>
          </p-accordion-content>
        </p-accordion-panel>
        }



      </p-accordion>
    </div>
  </p-dialog>
</div>


<!-- para nuevas habitaciones-->

<div class="card flex justify-center">
  <p-dialog header="Nuevo Platillo" [modal]="true" [(visible)]="visibleNuevoPlatillo" [style]="{ width: '30rem' }">

    <div class="flex items-center gap-4 mb-3">
      <label for="Nombre" class="font-semibold w-32">Nombre</label>
      <input pInputText id="nombre"
        class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" type="text"
        [(ngModel)]=this.nombre />
    </div>

    <!-- Precio -->
    <div class="flex items-center gap-4 mb-4">
      <label for="precio" class="font-semibold w-32">Precio</label>
      <input pInputText id="precio"
        class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none"
        type="number" [(ngModel)]=this.precio [min]="0" step="0.01" />
    </div>


    <div class="flex items-center gap-4 mb-3">
      <label for="tipoHabitacion" class="font-semibold w-32">Tipo Platillo</label>
      <p-select [options]="this.tipoPlatillos" optionLabel="label" placeholder="Selecciona tipo"
        class="flex-auto border border-gray-400 rounded px-2 py-1" [(ngModel)]=this.tipoPlatillo>
      </p-select>
    </div>



    <!-- Botones -->
    <div class="flex justify-end gap-2 mt-4">
      <p-button label="Cancelar" severity="secondary" (click)="visibleNuevoPlatillo = false" />
      <p-button label="Guardar" (click)="guardarHabitacion()" />
    </div>

  </p-dialog>
</div>

<!-- para la compra de platillos-->

<div class="card flex justify-center">
  <p-dialog header="Platillo a comprar" [modal]="true" [(visible)]="visibleCompraPlatilloEspecifico"
    [style]="{ width: '30rem' }">

    <!-- cantidad -->
    <div class="card flex justify-center">
      <label for="precio" class="font-semibold w-32">Cantidad</label>
      <input pInputText id="precio"
        class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none"
        type="number" [(ngModel)]=this.cantidadEspecifica [min]="0" step="0.01" />
    </div>


    <!-- Botones -->
    <div class="flex justify-end gap-2 mt-4">
      <p-button label="Cancelar" severity="secondary" (click)="visibleCompraPlatilloEspecifico = false" />
      <p-button label="Guardar"  />
    </div>

  </p-dialog>
</div>



<!-- para la generacion de comentarios RESTAURANTE-->

<div class="card flex justify-center">
  <p-dialog 
      header="Comentenos su experiencia" 
      [modal]="true" 
      [(visible)]="visibleComentario" 
      [style]="{ width: '30rem' }"
  >

      <!-- calificacion -->
       @for (item of this.carrito.getCarritoComentarios(); track $index) {

        <div class="card flex justify-center">
      <label for="nombre" class="font-semibold w-32">{{item.nombre}}</label>

            <p-rating  [(ngModel)]=item.puntuacion/>
      </div>

      <div class="flex items-center gap-4 mb-3">
        <label for="Nombre" class="font-semibold w-32">Comentario</label>
<textarea rows="5"cols="30" pTextarea [autoResize]="true"
[(ngModel)]=item.comentario
     ></textarea>
      </div>

       }


      <!-- Botones -->
      <div class="flex justify-end gap-2 mt-4">
        <p-button 
          label="Cancelar" 
          severity="secondary" 
          (click)="cerrarTodo()" 
        />
        <p-button 
          label="Guardar" 
          (click)="guardarComentarios()" 
        />
      </div>

  </p-dialog>
</div>