<app-header />


<!-- como header para ingresar nuevas habitaciones-->

<div class="card flex justify-center mb-2">
  <p-fieldset legend="Gestion de Habitacion">
    <p class="m-0">
      Para crear una nueva habitacion haga click en el boton
    </p>
    <p-button label="Nueva habitacion" class="w-full" styleClass="w-full" (onClick)="this.verDialogoNuevaHabitacion()" />
  </p-fieldset>
</div>

<!-- panel para el calendario-->
 <p-card class="max-w-6xl mx-auto mt-6 shadow-lg border border-gray-700 bg-gray-800 text-white">
  <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4">
    <div class="flex gap-2 mb-2 md:mb-0">
      <button mwlCalendarPreviousView
              [view]="view"
              [(viewDate)]="viewDate"
              (viewDateChange)="closeOpenMonthViewDay()"
              class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white">
        Anterior
      </button>
      <button mwlCalendarToday
              [(viewDate)]="viewDate"
              class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-white">
        Hoy
      </button>
      <button mwlCalendarNextView
              [view]="view"
              [(viewDate)]="viewDate"
              (viewDateChange)="closeOpenMonthViewDay()"
              class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white">
        Siguiente
      </button>
    </div>

    <h3 class="text-xl font-semibold">{{ viewDate | calendarDate: view + 'ViewTitle' : 'en' }}</h3>

    <div class="flex gap-2 mt-2 md:mt-0">
      <button (click)="setView(CalendarView.Month)"
              [ngClass]="{'bg-blue-600 text-white': view === CalendarView.Month, 'bg-gray-700 text-gray-300': view !== CalendarView.Month}"
              class="px-4 py-2 rounded">
        Mes
      </button>
      <button (click)="setView(CalendarView.Week)"
              [ngClass]="{'bg-blue-600 text-white': view === CalendarView.Week, 'bg-gray-700 text-gray-300': view !== CalendarView.Week}"
              class="px-4 py-2 rounded">
        Semana
      </button>
      <button (click)="setView(CalendarView.Day)"
              [ngClass]="{'bg-blue-600 text-white': view === CalendarView.Day, 'bg-gray-700 text-gray-300': view !== CalendarView.Day}"
              class="px-4 py-2 rounded">
        Dia
      </button>
    </div>
  </div>

  <div>
    <ng-container [ngSwitch]="view">
      <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" [viewDate]="viewDate" [events]="events" />
      <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" [viewDate]="viewDate" [events]="events" />
      <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day" [viewDate]="viewDate" [events]="events" />
    </ng-container>
  </div>
</p-card>


<!-- Panel LISTADO -->
<div class="h-full w-full mb-2">
  <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
          ">
    @for (item of this.listadoHabitaciones; track $index) {
    <p-card [style]="{
                width: '100%',
                overflow: 'hidden',
                borderRadius: '1rem',
                boxShadow: '0 4px 12px rgba(0,0,0,0.08)'
              }">

      <ng-template #title>
        <span style="font-weight: 600;">Habitacion No. {{ item.numero_habitacion }}</span>
      </ng-template>
      <ng-template #subtitle>
        <span style="color: #6b7280;">{{ item.direccion }}</span>
      </ng-template>
      <p style="color: #374151; margin: 0.5rem 0;">Cantidad de camas {{ item.cantidad_camas }}</p>
      <p style="color: #374151; margin: 0.5rem 0;">Precio {{ item.precio | currency:'GTQ':'symbol':'1.2-2' }}</p>

      <div class="card flex justify-center">
        <p-rating [(ngModel)]="item.promedio_valoracion" [readonly]="true"></p-rating>

      </div>

      <ng-template #footer>
        <div class="flex gap-4 mt-1">
          <p-button label="Ver comentarios" class="w-full" styleClass="w-full" (click)="showDialog(item.id)" />
          <p-button label="Reservar habitacion" class="w-full" styleClass="w-full"
            (onClick)="this.visibleReservacion= true" />
        </div>
      </ng-template>
    </p-card>
    }
  </div>

  <!-- paginator
        <div style="margin-top: 1rem; display: flex; justify-content: center;">
          <p-paginator
            [first]="first"
            [rows]="rows"
            [totalRecords]="items.length"
            [rowsPerPageOptions]="[3, 6, 10]"
          />
        </div> -->
</div>


<!-- comentarios en una habitacion-->
<div class="card flex justify-center">
  <p-dialog header="Comentarios" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
    <div class="card flex justify-content-center">
      <p-accordion value="0">
        @for (item of this.listadoComentarios; track $index) {
        <p-accordion-panel value="$index">
          <p-accordion-header>
            <ng-template #toggleicon let-active="active">
              @if (active) {
              <i class="pi pi-minus"></i>
              } @else {
              <i class="pi pi-plus"></i>
              }
            </ng-template>
            <span class="flex items-center gap-2 w-full">
              <span class="font-bold whitespace-nowrap">Comentario No.{{$index}}</span>
              <p-badge value="{{item.puntuacion}}" class="ml-auto mr-2" />
            </span>
          </p-accordion-header>
          <p-accordion-content>
            <p class="m-0">
              {{item.comentario}}
            </p>
          </p-accordion-content>
        </p-accordion-panel>
        }



      </p-accordion>
    </div>
  </p-dialog>
</div>


<!-- para nuevas habitaciones-->

<div class="card flex justify-center">
  <p-dialog 
      header="Nueva Habitación" 
      [modal]="true" 
      [(visible)]="visibleNuevaHabitacion" 
      [style]="{ width: '30rem' }"
  >

      <!-- Número de habitación -->
      <div class="flex items-center gap-4 mb-3">
        <label for="numero_habitacion" class="font-semibold w-32">Número Habitación</label>
        <input 
          pInputText 
          id="numero_habitacion" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" 
          type="number"
          [(ngModel)] =this.numeroHabitacion
        />
      </div>

      <!-- Cantidad de camas -->
      <div class="flex items-center gap-4 mb-3">
        <label for="cantidad_camas" class="font-semibold w-32">Cantidad Camas</label>
        <input 
          pInputText 
          id="cantidad_camas" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" 
          type="number"
          [(ngModel)] =this.cantidad_camas

        />
      </div>

      <!-- ID del hotel -->
      <div class="flex items-center gap-4 mb-3">
        <label for="id_hotel" class="font-semibold w-32">ID Hotel</label>
        <input 
          pInputText 
          id="id_hotel" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" 
          type="number"
          [(ngModel)] =this.hotel

        />
      </div>

      <!-- Tipo de habitación -->
      <div class="flex items-center gap-4 mb-3">
        <label for="tipoHabitacion" class="font-semibold w-32">Tipo Habitación</label>
        <p-select 
          [options]="this.tiposHabitacion" 
          optionLabel="label" 
          placeholder="Selecciona tipo" 
          class="flex-auto border border-gray-400 rounded px-2 py-1"
          [(ngModel)] =this.tipoHabitacion

        >
        </p-select>
      </div>

      <!-- Precio -->
      <div class="flex items-center gap-4 mb-4">
        <label for="precio" class="font-semibold w-32">Precio</label>
        <input 
          pInputText 
          id="precio" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none" 
          type="number" 
          [(ngModel)] =this.precio

          step="0.01"
        />
      </div>

      <!-- Botones -->
      <div class="flex justify-end gap-2 mt-4">
        <p-button 
          label="Cancelar" 
          severity="secondary" 
          (click)="visibleNuevaHabitacion = false" 
        />
        <p-button 
          label="Guardar" 
          (click)="guardarHabitacion()" 
        />
      </div>

  </p-dialog>
</div>

<!-- para reservar-->
<div class="card flex justify-center">
  <p-dialog 
      header="Generar Reservación" 
      [modal]="true" 
      [(visible)]="visibleReservacion" 
      [style]="{ width: '30rem' }"
  >

      <!-- Fecha Entrada -->
      <div class="flex items-center gap-4 mb-3">
        <label for="fechaEntrada" class="font-semibold w-32">Fecha Entrada</label>
        <input 
          pInputText 
          id="fechaEntrada" 
          type="date" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none"
          [(ngModel)]="fechaEntrada"
        />
      </div>

      <!-- Fecha Salida -->
      <div class="flex items-center gap-4 mb-3">
        <label for="fechaSalida" class="font-semibold w-32">Fecha Salida</label>
        <input 
          pInputText 
          id="fechaSalida" 
          type="date" 
          class="flex-auto border border-gray-400 rounded px-2 py-1 focus:border-blue-500 focus:outline-none"
          [(ngModel)]="fechaSalida"
        />
      </div>

      <!-- Habitación -->
      <div class="flex items-center gap-4 mb-3">
        <label for="habitacion" class="font-semibold w-32">Habitación</label>
          <p-dropdown 
            id="habitacion"
            [options]="this.listadoHabitaciones"
            optionLabel="numero_habitacion"
            optionValue="id"
            placeholder="Selecciona habitación"
            class="flex-auto"
            [(ngModel)]="habitacion"
          />

      </div>



 

      <!-- Botones -->
      <div class="flex justify-end gap-2 mt-4">
        <p-button 
          label="Cancelar" 
          severity="secondary" 
          (click)="visibleReservacion = false" 
        />
        <p-button 
          label="Guardar" 
          (click)="guardarReservacion()" 
        />
      </div>

  </p-dialog>
</div>
